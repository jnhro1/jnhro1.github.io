---
layout: post
title: "JWT ì ìš©í•˜ê¸°"
subtitle: "JWT"
categories: MOVESTER
tags: BACKEND
comments: true
---

- ëª©ì°¨
  - [1. JWT í† í°ì´ ë­ì•¼?](#)
  - [2. JWT ì ìš©í•˜ê¸°](#)
  - [2-1. JWT ë°œê¸‰í•˜ê¸°](#)
  - [2-2. JWT ê²€ì¦í•˜ê¸°](#)


<br>

## 1. JWT í† í°ì´ ë­ì•¼?

- Json Web Token
- JSON ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ë³ê³  ìê°€ìˆ˜ìš©ì ì¸ (self-contained: í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ìì²´ì ìœ¼ë¡œ ì§€ë‹˜) ë°©ì‹ìœ¼ë¡œ
 ì •ë³´ë¥¼ ì•ˆì „ì„± ìˆê²Œ ì „ë‹¬í•˜ëŠ” Web Token
- ìœ ì € ì¸ì¦ì„ í•˜ëŠ” í† í°ì„ í´ë¼ì´ì–¸íŠ¸ì˜ ì¿ í‚¤ì— ì €ì¥í• ê±´ë°, ì¿ í‚¤ëŠ” ë…¸ì¶œì´ ì‰¬ìš°ë¯€ë¡œ ë¯¼ê°í•œ ë°ì´í„°ê°€ ë‹´ê²¨ ìˆìœ¼ë©´ ì•ˆëœë‹¤.
- ë”°ë¼ì„œ jwt í† í°ì„ í™œìš©í•˜ì—¬ ì•”í˜¸í™”ëœ í† í°ì„ ë°œê¸‰í•˜ëŠ” ê²ƒâœ¨

<br><br>

### JWT êµ¬ì¡°

![jwt](/assets/img/movester/jwt.png)<br>

aaaaa.bbbbb.ccccc ì„¸ ë¶€ë¶„ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

- header : type(í† í°ì˜ íƒ€ì…), alg(í•´ì‹± ì•Œê³ ë¦¬ì¦˜)
- payload : í† í°ì— ë‹´ì„ ì •ë³´ (iss, sub, exp ...)
- signature : í† í°ì„ ì¸ì½”ë”©í•˜ê±°ë‚˜ ìœ íš¨ì„± ê²€ì¦ì„ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê³ ìœ í•œ ì•”í˜¸í™” ì½”ë“œ
signature ëŠ” headerì™€ payloadì˜ ê°’ì„ ê°ê° BASE64ë¡œ ì¸ì½”ë”©í•˜ê³ ,<br>
ì¸ì½”ë”©í•œ ê°’ì„ ë¹„ë°€ í‚¤ë¥¼ ì´ìš©í•˜ì—¬ headerì—ì„œ ì •ì˜í•œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ í•´ì‹±í•œ í›„,<br>
ì´ ê°’ì„ ë‹¤ì‹œ BASE64ë¡œ ì¸ì½”ë”©í•˜ì—¬ ìƒì„±í•œë‹¤.<br>

<br><br>

### JWT ë‹¨ì 

- ëª¨ë“  ì‚¬ìš©ìë“¤ì˜ ìƒíƒœë¥¼ ê¸°ì–µí•˜ê³  ìˆì§€ ì•Šë‹¤.
- ì´ë¯¸ ë°œê¸‰í•œ í† í°ì„ ëºì„ ìˆ˜ ì—†ë‹¤.
- ë”°ë¼ì„œ í•´ì»¤ì—ê²Œ í† í°ì´ ë¹¼ì•—ê²¼ë‹¤ë©´ ë¬´íš¨í™”í•  ìˆ˜ ì—†ë‹¤.

<br><br>

### ë‹¨ì  í•´ê²°ë²•

- accessToken, refreshToken 2ê°œë¥¼ ë°œê¸‰í•´ì¤€ë‹¤.
- accessToken : ìœ íš¨ ê¸°ê°„ì´ ì§§ë‹¤. (3h)
- refreshToken : ìœ íš¨ ê¸°ê°„ì´ ê¸¸ë‹¤. (ë³´í†µ 2ì£¼)
- ë¡œê·¸ì¸ì‹œ accessToken, refreshTokenì„ ë°œê¸‰í•´ì£¼ê³ , accessToken ë§Œë£Œ ì‹œ, refreshTokenì´ ìœ íš¨í•˜ë©´ accessTokenì„ ì¬ë°œê¸‰í•´ì¤€ë‹¤.

<br><br>

## 2. JWT ì ìš©í•˜ê¸°

### JWT ì„¤ì¹˜ ë° ì„¸íŒ…

`npm install --save jsonwebtoken`
í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ í†µí•´ jsonwebtoken ì„ ì„¤ì¹˜í•˜ì.<br><br>

config/jwt.js
```javascript
const jwtConfig = {
  secretKey: process.env.JWT_ACCESS_SECRET,
  refeshSecretKey: process.env.JWT_REFRESH_SECRET,
  option: {
    algorithm: 'HS256',
    expiresIn: process.env.JWT_ACCESS_TIME,
    issuer: 'movester',
  },
  refeshOption: {
    algorithm: 'HS256',
    expiresIn: process.env.JWT_REFRESH_TIME,
    issuer: 'movester',
  }
};
```
header, payload, signatureì— ë‹´ì„ ë°ì´í„° ì˜µì…˜ì„ ì„¸íŒ…í•´ë†“ëŠ”ë‹¤.<br>
secretKeyëŠ” ë³´ì•ˆì— ì§ê²°ë˜ë¯€ë¡œ env ë³€ìˆ˜ë¥¼ í™œìš©í•˜ì˜€ë‹¤.<br>
accessTokenì€ expiresInì„ ì§§ê²Œ, refreshTokenì€ ê¸¸ê²Œ ì„¤ì •í•œë‹¤.<br><br><br>


### JWT í† í° ë°œê¸‰

modules/jwt.js
```javascript
const signAccessToken = async user => jwt.sign(user, jwtConfig.secretKey, jwtConfig.option);
```

jwt ê´€ë ¨ ë©”ì†Œë“œë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´ modules í´ë”ì— ë³„ë„ë¡œ ë¶„ë¦¬í•˜ì˜€ë‹¤.<br><br>

service/admin.js
```javascript
const jwt = require('../modules/jwt');
//login logic ...
const token = {
      accessToken: await jwt.signAccessToken({ idx: admin.admin_idx, email: admin.email }),
      refreshToken: await jwt.signRefreshToken({ idx: admin.admin_idx, email: admin.email }),
    };
```

`jwt.sign(payload, secretKey, [options])`<br>
jwtëŠ” sign í•¨ìˆ˜ë¡œ í† í°ì„ ë°œê¸‰ë°›ëŠ”ë‹¤.<br>
ë‚˜ëŠ” payloadë¡œ idx, email ê°’ì„ ì£¼ì—ˆë‹¤. (í† í° decodeì‹œ ìœ ì €ì˜ idx, email ì–»ê¸° ìœ„í•´)<br>

<br><br>

### JWT í† í° ê²€ì¦

modules/jwt.js
```javascript
const verifyAccessToken = async token => {
  try {
    return jwt.verify(token, jwtConfig.secretKey);
  } catch (err) {
    console.log('token invalid');
  }
};
```
`jwt.verify(toekn, secretKey)`<br>
jwtëŠ” verify í•¨ìˆ˜ë¡œ í† í°ì„ ê²€ì¦í•œë‹¤.<br><br>

middleware/auth.js
```javascript
const accessToken = await jwt.verifyAccessToken(req.cookies.accessToken);
```

<br>

verifyë˜ì–´ ë‚˜ì˜¨ ê²°ê³¼ê°’ì„ ë‹´ì€ accessTokenì€ ìœ íš¨í•œ í† í°ì´ì—ˆë‹¤ë©´,
```javascript
{
  idx: 8,
  email: 'minsung',
  iat: 1643200950,
  exp: 1643204550,
  iss: 'movester'
}
```

ë‹¤ìŒê³¼ ê°™ì´ í† í°ì„ ë°œê¸‰í•  ë•Œ ì…ë ¥í•œ payloadë¥¼ ì¤€ë‹¤.<br>
ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì´ë¼ë©´, undefinedë¥¼ ì¤€ë‹¤. (try-catchë¬¸ì—ì„œ errë¡œ í‰ê°€ë˜ë¯€ë¡œ ì£¼ì˜í•˜ì.)<br><br><br>

ì§€ê¸ˆê¹Œì§€ jwt ê°€ ë¬´ì—‡ì´ê³ , node í™˜ê²½ì—ì„œ ì–´ë–»ê²Œ í† í°ì„ ë°œê¸‰ë°›ê³  ê²€ì¦í•˜ëŠ”ì§€ë¥¼ ì•Œì•„ë³´ì•˜ë‹¤.<br>
ë‹¤ìŒì—ëŠ” accessTokenê³¼ refreshTokenì„ í™œìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ì.ğŸ‹ï¸â€â™‚ï¸